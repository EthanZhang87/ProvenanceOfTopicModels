title: Modified discrete cosine transform
id: 231387
The modified discrete cosine transform MDCT is a transform based on the type IV discrete cosine transform DCT IV with the additional property of being lapped it is designed to be performed on consecutive blocks of a larger dataset where subsequent blocks are overlapped so that the last half of one block coincides with the first half of the next block This overlapping in addition to the energy compaction qualities of the DCT makes the MDCT especially attractive for signal compression applications since it helps to avoid artifacts stemming from the block boundaries As a result of these advantages the MDCT is the most widely used lossy compression technique in audio data compression It is employed in most modern audio coding standards including MP Dolby Digital AC Vorbis Ogg Windows Media Audio WMA ATRAC Cook Advanced Audio Coding AAC High Definition Coding HDC LDAC Dolby AC and MPEG H D Audio as well as speech coding standards such as AAC LD LD MDCT G G CELT and Opus br The discrete cosine transform DCT was first proposed by Nasir Ahmed in and demonstrated by Ahmed with T Natarajan and K R Rao in The MDCT was later proposed by John P Princen A W Johnson and Alan B Bradley at the University of Surrey in following earlier work by Princen and Bradley to develop the MDCT s underlying principle of time domain aliasing cancellation TDAC described below There also exists an analogous transform the MDST based on the discrete sine transform as well as other rarely used forms of the MDCT based on different types of DCT or DCT DST combinations br In MP the MDCT is not applied to the audio signal directly but rather to the output of a band polyphase quadrature filter PQF bank The output of this MDCT is postprocessed by an alias reduction formula to reduce the typical aliasing of the PQF filter bank Such a combination of a filter bank with an MDCT is called a hybrid filter bank or a subband MDCT AAC on the other hand normally uses a pure MDCT only the rarely used MPEG AAC SSR variant by Sony uses a four band PQF bank followed by an MDCT Similar to MP ATRAC uses stacked quadrature mirror filters QMF followed by an MDCT br br br Definition br As a lapped transform the MDCT is a bit unusual compared to other Fourier related transforms in that it has half as many outputs as inputs instead of the same number In particular it is a linear function br br br br F br br br br R br br br br N br br br br br br R br br br N br br br br br displaystyle F colon mathbf R N to mathbf R N br br where R denotes the set of real numbers The N real numbers x x N are transformed into the N real numbers X XN according to the formula br br br br br br X br br k br br br br br br br n br br br br br br N br br br br br br x br br n br br br cos br br br br br br br br N br br br br br br n br br br br br br br br br br br N br br br br br br br br br br k br br br br br br br br br br br br br br br br displaystyle X k sum n N x n cos left frac pi N left n frac frac N right left k frac right right br br br The normalization coefficient in front of this transform here unity is an arbitrary convention and differs between treatments Only the product of the normalizations of the MDCT and the IMDCT below is constrained br br br Inverse transform br The inverse MDCT is known as the IMDCT Because there are different numbers of inputs and outputs at first glance it might seem that the MDCT should not be invertible However perfect invertibility is achieved by adding the overlapped IMDCTs of subsequent overlapping blocks causing the errors to cancel and the original data to be retrieved this technique is known as time domain aliasing cancellation TDAC br The IMDCT transforms N real numbers X XN into N real numbers y y N according to the formula br br br br br br y br br n br br br br br br br N br br br br br br k br br br br br N br br br br br br X br br k br br br cos br br br br br br br br N br br br br br br n br br br br br br br br br br br N br br br br br br br br br br k br br br br br br br br br br br br br br br br displaystyle y n frac N sum k N X k cos left frac pi N left n frac frac N right left k frac right right br br br Like for the DCT IV an orthogonal transform the inverse has the same form as the forward transform br In the case of a windowed MDCT with the usual window normalization see below the normalization coefficient in front of the IMDCT should be multiplied by i e becoming N br br br Computation br Although the direct application of the MDCT formula would require O N operations it is possible to compute the same thing with only O N log N complexity by recursively factorizing the computation as in the fast Fourier transform FFT One can also compute MDCTs via other transforms typically a DFT FFT or a DCT combined with O N pre and post processing steps Also as described below any algorithm for the DCT IV immediately provides a method to compute the MDCT and IMDCT of even size br br br Window functions br br In typical signal compression applications the transform properties are further improved by using a window function wn n N that is multiplied with xn in the MDCT and with yn in the IMDCT formulas above in order to avoid discontinuities at the n and N boundaries by making the function go smoothly to zero at those points That is the window function is applied to the data before the MDCT or after the IMDCT In principle x and y could have different window functions and the window function could also change from one block to the next especially for the case where data blocks of different sizes are combined but for simplicity we consider the common case of identical window functions for equal sized blocks br The transform remains invertible that is TDAC works for a symmetric window wn w N n as long as w satisfies the Princen Bradley condition br br br br br br w br br n br br br br br br br br w br br n br br N br br br br br br br br br br displaystyle w n w n N br br br Various window functions are used A window that produces a form known as a modulated lapped transform MLT is given by br br br br br br w br br n br br br br sin br br br br br br br br br br N br br br br br br br n br br br br br br br br br br br br br br br br displaystyle w n sin left frac pi N left n frac right right br br br and is used for MP and MPEG AAC and br br br br br br w br br n br br br br sin br br br br br br br br br br br br sin br br br br br br br br br br br br br br N br br br br br br br n br br br br br br br br br br br br br br br br br br br displaystyle w n sin left frac pi sin left frac pi N left n frac right right right br br br for Vorbis AC uses a Kaiser Bessel derived KBD window and MPEG AAC can also use a KBD window br Note that windows applied to the MDCT are different from windows used for some other types of signal analysis since they must fulfill the Princen Bradley condition One of the reasons for this difference is that MDCT windows are applied twice for both the MDCT analysis and the IMDCT synthesis br br br Relationship to DCT IV and Origin of TDAC br As can be seen by inspection of the definitions for even N the MDCT is essentially equivalent to a DCT IV where the input is shifted by N and two N blocks of data are transformed at once By examining this equivalence more carefully important properties like TDAC can be easily derived br In order to define the precise relationship to the DCT IV one must realize that the DCT IV corresponds to alternating even odd boundary conditions even at its left boundary around n odd at its right boundary around n N and so on instead of periodic boundaries as for a DFT This follows from the identities br br br br cos br br br br br br br br N br br br br br br br n br br br br br br br br br br br br br br br br k br br br br br br br br br br br br br br br cos br br br br br br br br N br br br br br br n br br br br br br br br br br br br br br k br br br br br br br br br br br br br br br br displaystyle cos left frac pi N left n frac right left k frac right right cos left frac pi N left n frac right left k frac right right br br and br br br br cos br br br br br br br br N br br br br br br br N br br n br br br br br br br br br br br br br br br br k br br br br br br br br br br br br br br br br cos br br br br br br br br N br br br br br br n br br br br br br br br br br br br br br k br br br br br br br br br br br br br br br br displaystyle cos left frac pi N left N n frac right left k frac right right cos left frac pi N left n frac right left k frac right right br br Thus if its inputs are an array x of length N we can imagine extending this array to x xR x xR and so on where xR denotes x in reverse order br Consider an MDCT with N inputs and N outputs where we divide the inputs into four blocks a b c d each of size N If we shift these to the right by N from the N term in the MDCT definition then b c d extend past the end of the N DCT IV inputs so we must fold them back according to the boundary conditions described above br br Thus the MDCT of N inputs a b c d is exactly equivalent to a DCT IV of the N inputs cR d a bR where R denotes reversal as above br In this way any algorithm to compute the DCT IV can be trivially applied to the MDCT br Similarly the IMDCT formula above is precisely of the DCT IV which is its own inverse where the output is extended via the boundary conditions to a length N and shifted back to the left by N The inverse DCT IV would simply give back the inputs cR d a bR from above When this is extended via the boundary conditions and shifted one obtains br br IMDCT MDCT a b c d a bR b aR c dR d cR br Half of the IMDCT outputs are thus redundant as b aR a bR R and likewise for the last two terms If we group the input into bigger blocks A B of size N where A a b and B c d we can write this result in a simpler way br br IMDCT MDCT A B A AR B BR br One can now understand how TDAC works Suppose that one computes the MDCT of the subsequent overlapped N block B C The IMDCT will then yield analogous to the above B BR C CR When this is added with the previous IMDCT result in the overlapping half the reversed terms cancel and one obtains simply B recovering the original data br br br Origin of TDAC br The origin of the term time domain aliasing cancellation is now clear The use of input data that extend beyond the boundaries of the logical DCT IV causes the data to be aliased in the same way that frequencies beyond the Nyquist frequency are aliased to lower frequencies except that this aliasing occurs in the time domain instead of the frequency domain we cannot distinguish the contributions of br a and of bR to the MDCT of a b c d or equivalently to br the result of br br IMDCT MDCT a b c d a bR b aR c dR d cR br The combinations c dR and so on have precisely the right signs for the combinations to cancel when they are added br For odd N which are rarely used in practice N is not an integer so the MDCT is not simply a shift permutation of a DCT IV In this case the additional shift by half a sample means that the MDCT IMDCT becomes equivalent to the DCT III II and the analysis is analogous to the above br br br Smoothness and discontinuities br We have seen above that the MDCT of N inputs a b br c d is equivalent to a DCT IV of the N inputs br cR d br a bR br The DCT IV is designed for the br case where the function at the right boundary is odd and therefore br the values near the right boundary are close to If the input signal is smooth br this is the case the rightmost components of a and bR are br consecutive in the input sequence a b c d and br therefore their difference is small br Let us look at the middle of the interval br if we rewrite the above expression as br cR d br a bR d a b c R br the second term b c R gives a smooth br transition in the middle br However in the first term d a there is a br potential discontinuity where the right end of br d meets the left end of a br This is the reason for using a window function that reduces the components br near the boundaries of the input sequence a b br c d towards br br br TDAC for the windowed MDCT br Above the TDAC property was proved for the ordinary MDCT showing that adding IMDCTs of subsequent blocks in their overlapping half recovers the original data The derivation of this inverse property for the windowed MDCT is only slightly more complicated br Consider to overlapping consecutive sets of N inputs A B and B C for blocks A B C of size N br Recall from above that when br br br br br A br br B br br br br displaystyle A B br br and br br br br br B br br C br br br br displaystyle B C br br are MDCTed IMDCTed and added in their overlapping half we obtain br br br br br B br br br B br br R br br br br br br br br br br B br br br B br br R br br br br br br br br br B br br br displaystyle B B R B B R B br br the original data br Now we suppose that we multiply both the MDCT inputs and the IMDCT outputs by a window function of length N As above we assume a symmetric window function which is therefore of the form br br br br br W br br br W br br R br br br br br br displaystyle W W R br br where W is a length N vector and R denotes reversal as before Then the Princen Bradley condition can be written as br br br br br W br br br br br br br W br br R br br br br br br br br br br br br br br br br displaystyle W W R ldots br br with the squares and additions performed elementwise br Therefore instead of MDCTing br br br br br A br br B br br br br displaystyle A B br br we now MDCT br br br br br W br A br br br W br br R br br br B br br br br displaystyle WA W R B br br with all multiplications performed elementwise When this is IMDCTed and multiplied again elementwise by the window function the last N half becomes br br br br br br W br br R br br br br br br W br br R br br br B br br br br W br br R br br br B br br br br R br br br br br br W br br R br br br br br br W br br R br br br B br br W br br B br br R br br br br br br W br br R br br br br br br B br br W br br W br br R br br br br B br br R br br br br br displaystyle W R cdot W R B W R B R W R cdot W R B WB R W R B WW R B R br br br Note that we no longer have the multiplication by because the IMDCT normalization differs by a factor of in the windowed case br Similarly the windowed MDCT and IMDCT of br br br br br B br br C br br br br displaystyle B C br br yields in its first N half br br br br br W br br br W br B br br br W br br R br br br br B br br R br br br br br br W br br br br br B br br W br br W br br R br br br br B br br R br br br br br displaystyle W cdot WB W R B R W B WW R B R br br br When we add these two halves together we obtain br br br br br br br W br br R br br br br br br B br br W br br W br br R br br br br B br br R br br br br br br br W br br br br br B br br W br br W br br R br br br br B br br R br br br br br br br br br W br br R br br br br br br br br W br br br br br br br br B br br B br br br br displaystyle W R B WW R B R W B WW R B R left W R W right B B br br br recovering the original data br br br See also br Discrete cosine transform br Other overlapping windowed Fourier transforms include br Modulated complex lapped transform br Short time Fourier transform br Welch s method br Audio coding format br Audio compression data br br br br br br Bibliography br Henrique S Malvar Signal Processing with Lapped Transforms Artech House Norwood MA br A W Johnson and A B Bradley Adaptive transform coding incorporating time domain aliasing cancellation Speech Comm br For algorithms see examples br Chi Min Liu and Wen Chieh Lee A unified fast algorithm for cosine modulated filterbanks in current audio standards J Audio Engineering br V Britanak and K R Rao A new fast algorithm for the unified forward and inverse MDCT MDST computation Signal Processing br Vladimir Nikolajevic and Gerhard Fettweis Computation of forward and inverse MDCT using Clenshaw s recurrence formula IEEE Trans Sig Proc br Che Hong Chen Bin Da Liu and Jar Ferr Yang Recursive architectures for realizing modified discrete cosine transform and its inverse IEEE Trans Circuits Syst II Analog Dig Sig Proc br J S Wu H Z Shu L Senhadji and L M Luo Mixed radix algorithm for the computation of forward and inverse MDCTs IEEE Trans Circuits Syst I Reg Papers br V Britanak A survey of efficient MDCT implementations in MP audio coding standard retrospective and state of the art Signal Process 