title: FileVault
id: 466854
FileVault is a disk encryption program in Mac OS X Panther and later It performs on the fly encryption with volumes on Mac computers br br br Versions and key features br FileVault was introduced with Mac OS X Panther and could only be applied to a user s home directory not the startup volume The operating system uses an encrypted sparse disk image a large single file to present a volume for the home directory Mac OS X Leopard and Mac OS X Snow Leopard use more modern sparse bundle disk images which spread the data over MB files called bands within a bundle Apple refers to this original iteration of FileVault as legacy FileVault br OS X Lion and newer versions offer FileVault which is a significant redesign This encrypts the entire OS X startup volume and typically includes the home directory abandoning the disk image approach For this approach to disk encryption authorised users information is loaded from a separate non encrypted boot volume partition slice type Apple Boot br br br FileVault br The original version of FileVault was added in Mac OS X Panther to encrypt a user s home directory br br br Master passwords and recovery keys br When FileVault is enabled the system invites the user to create a master password for the computer If a user password is forgotten the master password or recovery key may be used to decrypt the files instead FileVault recovery key is different from a Mac recovery key which is a character code used to reset your password or regain access to your Apple ID br br br Migration br Migration of FileVault home directories is subject to two limitations br br there must be no prior migration to the target computer br the target must have no existing user accounts br If Migration Assistant has already been used or if there are user accounts on the target br br before migration FileVault must be disabled at the source br If transferring FileVault data from a previous Mac that uses using the built in utility to move data to a new machine the data continues to be stored in the old sparse image format and the user must turn FileVault off and then on again to re encrypt in the new sparse bundle format br br br Manual encryption br Instead of using FileVault to encrypt a user s home directory using Disk Utility a user can create an encrypted disk image themselves and store any subset of their home directory in there for example Documents private This encrypted image behaves similar to a FileVault encrypted home directory but is under the user s maintenance br Encrypting only a part of a user s home directory might be problematic when applications need access to the encrypted files which will not be available until the user mounts the encrypted image This can be mitigated to a certain extent by making symbolic links for these specific files br br br Limitations and issues br br br Backups br br Without Mac OS X Server Time Machine will back up a FileVault home directory only while the user is logged out In such cases Time Machine is limited to backing up the home directory in its entirety Using Mac OS X Server as a Time Machine destination backups of FileVault home directories occur while users are logged in br Because FileVault restricts the ways in which other users processes can access the user s content some third party backup solutions can back up the contents of a user s FileVault home directory only if other parts of the computer including other users home directories are excluded br br br Issues br Several shortcomings were identified in legacy FileVault Its security can be broken by cracking either bit RSA or DES EDE br Legacy FileVault used the CBC mode of operation see disk encryption theory FileVault uses stronger XTS AES mode Another issue is storage of keys in the macOS safe sleep mode A study published in found data remanence in dynamic random access memory DRAM with data retention of seconds to minutes at room temperature and much longer times when memory chips were cooled to low temperature The study authors were able to use a cold boot attack to recover cryptographic keys for several popular disk encryption systems including FileVault by taking advantage of redundancy in the way keys are stored after they have been expanded for efficient use such as in key scheduling The authors recommend that computers be powered down rather than be left in a sleep state when not in physical control by the owner br Early versions of FileVault automatically stored the user s passphrase in the system keychain requiring the user to notice and manually disable this security hole br In following a talk at the rd Chaos Communication Congress titled Unlocking FileVault An Analysis of Apple s Encrypted Disk Storage System Jacob Appelbaum Ralf Philipp Weinmann released VileFault which decrypts encrypted Mac OS X disk image files br A free space wipe using Disk Utility left a large portion of previously deleted file remnants intact Similarly FileVault compact operations only wiped small parts of previously deleted data br br br FileVault br br br Security br FileVault uses the user s login password as the encryption pass phrase It uses the XTS AES mode of AES with bit blocks and a bit key to encrypt the disk as recommended by NIST Only unlock enabled users can start or unlock the drive Once unlocked other users may also use the computer until it is shut down br br br Performance br The I O performance penalty for using FileVault was found to be in the order of around when using CPUs with the AES instruction set such as the Intel Core i and OS X Yosemite Performance deterioration will be larger for CPUs without this instruction set such as older Core CPUs br br br Master passwords and recovery keys br When FileVault is enabled while the system is running the system creates and displays a recovery key for the computer and optionally offers the user to store the key with Apple The bit recovery key is encoded with all letters and numbers through and read from dev random and therefore relies on the security of the PRNG used in macOS During a cryptanalysis in this mechanism was found safe br Changing the recovery key is not possible without re encrypting the File Vault volume br br br Validation br Users who use FileVault in OS X and above can validate their key correctly works after encryption by running sudo fdesetup validaterecovery in Terminal after encryption has finished The key must be in form xxxx xxxx xxxx xxxx xxxx xxxx and will return true if correct br br br Starting the OS with FileVault without a user account br If a volume to be used for startup is erased and encrypted before clean installation of OS X Lion or Mountain Lion br br there is a password for the volume br the clean system will immediately behave as if FileVault was enabled after installation br there is no recovery key no option to store the key with Apple but the system will behave as if a key was created br when the computer is started Disk Password will appear at the EfiLoginUI this may be used to unlock the volume and start the system br the running system will present the traditional login window br Apple describes this type of approach as Disk Password based DEK br br br See also br Apple Keychain br BitLocker br TrueCrypt br VeraCrypt br LUKS br br br 