title: Color balance
id: 1561411
In photography and image processing color balance is the global adjustment of the intensities of the colors typically red green and blue primary colors An important goal of this adjustment is to render specific colors particularly neutral colors like white or grey correctly Hence the general method is sometimes called gray balance neutral balance or white balance Color balance changes the overall mixture of colors in an image and is used for color correction Generalized versions of color balance are used to correct colors other than neutrals or to deliberately change them for effect White balance is one of the most common kinds of balancing and is when colors are adjusted to make a white object such as a piece of paper or a wall appear white and not a shade of any other colour br Image data acquired by sensors either film or electronic image sensors must be transformed from the acquired values to new values that are appropriate for color reproduction or display Several aspects of the acquisition and display process make such color correction essential including that the acquisition sensors do not match the sensors in the human eye that the properties of the display medium must be accounted for and that the ambient viewing conditions of the acquisition differ from the display viewing conditions br The color balance operations in popular image editing applications usually operate directly on the red green and blue channel pixel values without respect to any color sensing or reproduction model In film photography color balance is typically achieved by using color correction filters over the lights or on the camera lens br br br Generalized color balance br br Sometimes the adjustment to keep neutrals neutral is called white balance and the phrase color balance refers to the adjustment that in addition makes other colors in a displayed image appear to have the same general appearance as the colors in an original scene It is particularly important that neutral gray neutral white colors in a scene appear neutral in the reproduction br br br Psychological color balance br Humans relate to flesh tones more critically than other colors Trees grass and sky can all be off without concern but if human flesh tones are off then the human subject can look sick or dead To address this critical color balance issue the tri color primaries themselves are formulated to not balance as a true neutral color The purpose of this color primary imbalance is to more faithfully reproduce the flesh tones through the entire brightness range br br br Illuminant estimation and adaptation br br Most digital cameras have means to select color correction based on the type of scene lighting using either manual lighting selection automatic white balance or custom white balance The algorithms for these processes perform generalized chromatic adaptation br Many methods exist for color balancing Setting a button on a camera is a way for the user to indicate to the processor the nature of the scene lighting Another option on some cameras is a button which one may press when the camera is pointed at a gray card or other neutral colored object This captures an image of the ambient light which enables a digital camera to set the correct color balance for that light br There is a large literature on how one might estimate the ambient lighting from the camera data and then use this information to transform the image data A variety of algorithms have been proposed and the quality of these has been debated A few examples and examination of the references therein will lead the reader to many others Examples are Retinex an artificial neural network or a Bayesian method br br br Chromatic colors br Color balancing an image affects not only the neutrals but other colors as well An image that is not color balanced is said to have a color cast as everything in the image appears to have been shifted towards one color Color balancing may be thought in terms of removing this color cast br Color balance is also related to color constancy Algorithms and techniques used to attain color constancy are frequently used for color balancing as well Color constancy is in turn related to chromatic adaptation Conceptually color balancing consists of two steps first determining the illuminant under which an image was captured and second scaling the components e g R G and B of the image or otherwise transforming the components so they conform to the viewing illuminant br Viggiano found that white balancing in the camera s native RGB color model tended to produce less color inconstancy i e less distortion of the colors than in monitor RGB for over hypothetical sets of camera sensitivities This difference typically amounted to a factor of more than two in favor of camera RGB This means that it is advantageous to get color balance right at the time an image is captured rather than edit later on a monitor If one must color balance later balancing the raw image data will tend to produce less distortion of chromatic colors than balancing in monitor RGB br br br Mathematics of color balance br Color balancing is sometimes performed on a three component image e g RGB using a x matrix This type of transformation is appropriate if the image was captured using the wrong white balance setting on a digital camera or through a color filter br br br Scaling monitor R G and B br In principle one wants to scale all relative luminances in an image so that objects which are believed to be neutral appear so If say a surface with br br br br R br br br br br displaystyle R br br was believed to be a white object and if is the count which corresponds to white one could multiply all red values by Doing analogously for green and blue would result at least in theory in a color balanced image In this type of transformation the x matrix is a diagonal matrix br br br br br br br br br br br R br br br br br G br br br br br B br br br br br br br br br br br br br br br br br br br R br br w br br br br br br br br br br br br br br br br br br br br br br G br br w br br br br br br br br br br br br br br br br br br br br br br B br br w br br br br br br br br br br br br br br br br br R br br br br br br br br G br br br br br br br br B br br br br br br br br br br br displaystyle left begin array c R G B end array right left begin array ccc R w G w B w end array right left begin array c R G B end array right br br br where br br br br R br br br displaystyle R br br br br br br G br br br displaystyle G br br and br br br br B br br br displaystyle B br br are the color balanced red green and blue components of a pixel in the image br br br br br R br br br br br displaystyle R br br br br br br br G br br br br br displaystyle G br br and br br br br br B br br br br br displaystyle B br br are the red green and blue components of the image before color balancing and br br br br br R br br w br br br br br br displaystyle R w br br br br br br br G br br w br br br br br br displaystyle G w br br and br br br br br B br br w br br br br br br displaystyle B w br br are the red green and blue components of a pixel which is believed to be a white surface in the image before color balancing This is a simple scaling of the red green and blue channels and is why color balance tools in Photoshop have a white eyedropper tool It has been demonstrated that performing the white balancing in the phosphor set assumed by sRGB tends to produce large errors in chromatic colors even though it can render the neutral surfaces perfectly neutral br br br Scaling X Y Z br If the image may be transformed into CIE XYZ tristimulus values the color balancing may be performed there This has been termed a wrong von Kries transformation Although it has been demonstrated to offer usually poorer results than balancing in monitor RGB it is mentioned here as a bridge to other things Mathematically one computes br br br br br br br br br br br X br br br br br Y br br br br br Z br br br br br br br br br br br br br br br X br br w br br br br br br br X br br w br br br br br br br br br br br br br br br br br br Y br br w br br br br br br br Y br br w br br br br br br br br br br br br br br br br br br Z br br w br br br br br br br Z br br w br br br br br br br br br br br br br br br br br X br br br br br br br br Y br br br br br br br br Z br br br br br br br br br br br displaystyle left begin array c X Y Z end array right left begin array ccc X w X w Y w Y w Z w Z w end array right left begin array c X Y Z end array right br br br where br br br br X br br br displaystyle X br br br br br br Y br br br displaystyle Y br br and br br br br Z br br br displaystyle Z br br are the color balanced tristimulus values br br br br br X br br w br br br br br displaystyle X w br br br br br br br Y br br w br br br br br displaystyle Y w br br and br br br br br Z br br w br br br br br displaystyle Z w br br are the tristimulus values of the viewing illuminant the white point to which the image is being transformed to conform to br br br br br X br br w br br br br br br displaystyle X w br br br br br br br Y br br w br br br br br br displaystyle Y w br br and br br br br br Z br br w br br br br br br displaystyle Z w br br are the tristimulus values of an object believed to be white in the un color balanced image and br br br br br X br br br br br displaystyle X br br br br br br br Y br br br br br displaystyle Y br br and br br br br br Z br br br br br displaystyle Z br br are the tristimulus values of a pixel in the un color balanced image If the tristimulus values of the monitor primaries are in a matrix br br br br br P br br br br displaystyle mathbf P br br so that br br br br br br br br br br br X br br br br br Y br br br br br Z br br br br br br br br br P br br br br br br br br br L br br R br br br br br br br br L br br G br br br br br br br br L br br B br br br br br br br br br br br displaystyle left begin array c X Y Z end array right mathbf P left begin array c L R L G L B end array right br br br where br br br br br L br br R br br br br br displaystyle L R br br br br br br br L br br G br br br br br displaystyle L G br br and br br br br br L br br B br br br br br displaystyle L B br br are the un gamma corrected monitor RGB one may use br br br br br br br br br br br br L br br R br br br br br br br br L br br G br br br br br br br br L br br B br br br br br br br br br br br br P br br br br br br br br br br br br br br X br br w br br br br br br br X br br w br br br br br br br br br br br br br br br br br br Y br br w br br br br br br br Y br br w br br br br br br br br br br br br br br br br br br Z br br w br br br br br br br Z br br w br br br br br br br br br br br P br br br br br br br br br L br br br R br br br br br br br br br br L br br br G br br br br br br br br br br L br br br B br br br br br br br br br br br br br displaystyle left begin array c L R L G L B end array right mathbf P left begin array ccc X w X w Y w Y w Z w Z w end array right mathbf P left begin array c L R L G L B end array right br br br br Von Kries s method br Johannes von Kries whose theory of rods and three color sensitive cone types in the retina has survived as the dominant explanation of color sensation for over years motivated the method of converting color to the LMS color space representing the effective stimuli for the Long Medium and Short wavelength cone types that are modeled as adapting independently A x matrix converts RGB or XYZ to LMS and then the three LMS primary values are scaled to balance the neutral the color can then be converted back to the desired final color space br br br br br br br br br br br L br br br br br M br br br br br S br br br br br br br br br br br br br br br br br br br L br br w br br br br br br br br br br br br br br br br br br br br br br M br br w br br br br br br br br br br br br br br br br br br br br br br S br br w br br br br br br br br br br br br br br br br br L br br br br br br br br M br br br br br br br br S br br br br br br br br br br br displaystyle left begin array c L M S end array right left begin array ccc L w M w S w end array right left begin array c L M S end array right br br br where br br br br L br br br displaystyle L br br br br br br M br br br displaystyle M br br and br br br br S br br br displaystyle S br br are the color balanced LMS cone tristimulus values br br br br br L br br w br br br br br br displaystyle L w br br br br br br br M br br w br br br br br br displaystyle M w br br and br br br br br S br br w br br br br br br displaystyle S w br br are the tristimulus values of an object believed to be white in the un color balanced image and br br br br br L br br br br br displaystyle L br br br br br br br M br br br br br displaystyle M br br and br br br br br S br br br br br displaystyle S br br are the tristimulus values of a pixel in the un color balanced image br Matrices to convert to LMS space were not specified by von Kries but can be derived from CIE color matching functions and LMS color matching functions when the latter are specified matrices can also be found in reference books br br br Scaling camera RGB br By Viggiano s measure and using his model of gaussian camera spectral sensitivities most camera RGB spaces performed better than either monitor RGB or XYZ If the camera s raw RGB values are known one may use the x diagonal matrix br br br br br br br br br br br R br br br br br G br br br br br B br br br br br br br br br br br br br br br br br br br R br br w br br br br br br br br br br br br br br br br br br br br br br G br br w br br br br br br br br br br br br br br br br br br br br br br B br br w br br br br br br br br br br br br br br br br br R br br br br br br br br G br br br br br br br br B br br br br br br br br br br br displaystyle left begin array c R G B end array right left begin array ccc R w G w B w end array right left begin array c R G B end array right br br br and then convert to a working RGB space such as sRGB or Adobe RGB after balancing br br br Preferred chromatic adaptation spaces br Comparisons of images balanced by diagonal transforms in a number of different RGB spaces have identified several such spaces that work better than others and better than camera or monitor spaces for chromatic adaptation as measured by several color appearance models the systems that performed statistically as well as the best on the majority of the image test sets used were the Sharp Bradford CMCCAT and ROMM spaces br br br General illuminant adaptation br The best color matrix for adapting to a change in illuminant is not necessarily a diagonal matrix in a fixed color space It has long been known that if the space of illuminants can be described as a linear model with N basis terms the proper color transformation will be the weighted sum of N fixed linear transformations not necessarily consistently diagonalizable br br br Examples br br br See also br Color cast br Color temperature br Gamma correction br White point br br br br br br External links br White Balance Intro at nikondigital org br photoskop Interactive Photography Lessons Interactive White Balance br Understanding White Balance Tutorial br Affine color balance with saturation with code and on line demonstration br Getting the White Balance Right for Neutral Colors Photography Tutorial