title: Weighted arithmetic mean
id: 33274
The weighted arithmetic mean is similar to an ordinary arithmetic mean the most common type of average except that instead of each of the data points contributing equally to the final average some data points contribute more than others The notion of weighted mean plays a role in descriptive statistics and also occurs in a more general form in several other areas of mathematics br If all the weights are equal then the weighted mean is the same as the arithmetic mean While weighted means generally behave in a similar fashion to arithmetic means they do have a few counterintuitive properties as captured for instance in Simpson s paradox br br br Examples br br br Basic example br Given two school classes one with students one with students and test grades in each class as follows br br Morning class br br Afternoon class br The mean for the morning class is and the mean of the afternoon class is The unweighted mean of the two means is However this does not account for the difference in number of students in each class versus hence the value of does not reflect the average student grade independent of class The average student grade can be obtained by averaging all the grades without regard to classes add all the grades up and divide by the total number of students br br Or this can be accomplished by weighting the class means by the number of students in each class The larger class is given more weight br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br displaystyle bar x frac times times br br br Thus the weighted mean makes it possible to find the mean average student grade without knowing each student s score Only the class means and the number of students in each class are needed br br br Convex combination example br Since only the relative weights are relevant any weighted mean can be expressed using coefficients that sum to one Such a linear combination is called a convex combination br Using the previous example we would get the following weights br br br br br br br br br br br br br br br br br br br displaystyle frac br br br br br br br br br br br br br br br br br br br br displaystyle frac br br br Then apply the weights like this br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br displaystyle bar x times times br br br br Mathematical definition br Formally the weighted mean of a non empty finite tuple of data br br br br br br br br x br br br br br br br x br br br br br br br br br x br br n br br br br br br br br displaystyle left x x dots x n right br br br with corresponding non negative weights br br br br br br br br w br br br br br br br w br br br br br br br br br w br br n br br br br br br br br displaystyle left w w dots w n right br br is br br br br br br br br x br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br x br br i br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br br displaystyle bar x frac sum limits i n w i x i sum limits i n w i br br br which expands to br br br br br br br br x br br br br br br br br br br w br br br br br br x br br br br br br br w br br br br br br x br br br br br br br br br w br br n br br br br x br br n br br br br br br w br br br br br br br w br br br br br br br br br w br br n br br br br br br br br br displaystyle bar x frac w x w x cdots w n x n w w cdots w n br br br Therefore data elements with a high weight contribute more to the weighted mean than do elements with a low weight The weights may not be negative in order for the equation to work Some may be zero but not all of them since division by zero is not allowed br The formulas are simplified when the weights are normalized such that they sum up to i e br br br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br textstyle sum limits i n w i br br br For such normalized weights the weighted mean is equivalently br br br br br br br br x br br br br br br br br br i br br br br br n br br br br br w br br i br br br br br x br br i br br br br br br displaystyle bar x sum limits i n w i x i br br br One can always normalize the weights by making the following transformation on the original weights br br br br br br w br br i br br br br br br br br w br br i br br br br br br br j br br br br br n br br br br br w br br j br br br br br br br br br displaystyle w i frac w i sum limits j n w j br br br The ordinary mean br br br br br br br n br br br br br br i br br br br br n br br br br br x br br i br br br br br br textstyle frac n sum limits i n x i br br is a special case of the weighted mean where all data have equal weights br If the data elements are independent and identically distributed random variables with variance br br br br br br br br br br br br displaystyle sigma br br the standard error of the weighted mean br br br br br br br br br x br br br br br br br br displaystyle sigma bar x br br can be shown via uncertainty propagation to be br br br br br br br br br br x br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br br br br br br textstyle sigma bar x sigma sqrt sum limits i n w i br br br br Variance defined weights br br For the weighted mean of a list of data for which each element br br br br br x br br i br br br br br displaystyle x i br br potentially comes from a different probability distribution with known variance br br br br br br br i br br br br br br br br displaystyle sigma i br br all having the same mean one possible choice for the weights is given by the reciprocal of variance br br br br br br w br br i br br br br br br br br br br i br br br br br br br br br br br displaystyle w i frac sigma i br br br The weighted mean in this case is br br br br br br br br x br br br br br br br br br br br br i br br br br br n br br br br br br br br br x br br i br br br br br br i br br br br br br br br br br br br br br br br i br br br br br n br br br br br br br br br br i br br br br br br br br br br br br br br br br br br br i br br br br br n br br br br br br br x br br i br br br br br w br br i br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br br displaystyle bar x frac sum i n left dfrac x i sigma i right sum i n dfrac sigma i frac sum i n left x i cdot w i right sum i n w i br br br and the standard error of the weighted mean with inverse variance weights is br br br br br br br br br br x br br br br br br br br br br br br br br br i br br br br br n br br br br br br i br br br br br br br br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br br br displaystyle sigma bar x sqrt frac sum i n sigma i sqrt frac sum i n w i br br br Note this reduces to br br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br n br br br displaystyle sigma bar x sigma n br br when all br br br br br br br i br br br br br br br br br br br br displaystyle sigma i sigma br br br It is a special case of the general formula in previous section br br br br br br br br br br x br br br br br br br br br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br br br br i br br br br br br br br br br br br br br i br br br br br n br br br br br br br i br br br br br br br br br br i br br br br br br br br br br br br br br br i br br br br br n br br br br br br i br br br br br br br br br br br br br br br br br br br displaystyle sigma bar x sum i n w i sigma i frac sum i n sigma i sigma i left sum i n sigma i right br br br The equations above can be combined to obtain br br br br br br br br x br br br br br br br br br br br x br br br br br br br br br br br br i br br br br br n br br br br br br x br br i br br br br br br i br br br br br br br br br br br displaystyle bar x sigma bar x sum i n frac x i sigma i br br br The significance of this choice is that this weighted mean is the maximum likelihood estimator of the mean of the probability distributions under the assumption that they are independent and normally distributed with the same mean br br br Statistical properties br br br Expectancy br The weighted sample mean br br br br br br br x br br br br br br br displaystyle bar x br br is itself a random variable Its expected value and standard deviation are related to the expected values and standard deviations of the observations as follows For simplicity we assume normalized weights weights summing to one br If the observations have expected values br br then the weighted sample mean has expectation br br In particular if the means are equal br br br br br br br i br br br br br br br displaystyle mu i mu br br then the expectation of the weighted sample mean will be that value br br br Variance br br br Simple i i d case br When treating the weights as constants and having a sample of n observations from uncorrelated random variables all with the same variance and expectation as is the case for i i d random variables then the variance of the weighted mean can be estimated as the multiplication of the unweighted variance by Kish s design effect see proof br br br br br Var br br br br br br br y br br br br br br w br br br br br br br br br br br br br br br y br br br br br br br br br br w br br br br br br br br br br br w br br br br br br br br br br br br br displaystyle operatorname Var bar y w hat sigma y frac overline w bar w br br br With br br br br br br br br br br br br br br y br br br br br br br br br br br br br i br br br br br n br br br br br y br br i br br br br br br br y br br br br br br br br br br br br br n br br br br br br br br displaystyle hat sigma y frac sum i n y i bar y n br br br br br br br br br w br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br n br br br br br displaystyle bar w frac sum i n w i n br br and br br br br br br br w br br br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br n br br br br br displaystyle overline w frac sum i n w i n br br br However this estimation is rather limited due to the strong assumption about the y observations This has led to the development of alternative more general estimators br br br Survey sampling perspective br From a model based perspective we are interested in estimating the variance of the weighted mean when the different br br br br br y br br i br br br br br displaystyle y i br br are not i i d random variables An alternative perspective for this problem is that of some arbitrary sampling design of the data in which units are selected with unequal probabilities with replacement br In Survey methodology the population mean of some quantity of interest y is calculated by taking an estimation of the total of y over all elements in the population Y or sometimes T and dividing it by the population size either known br br br br N br br br displaystyle N br br or estimated br br br br br br br N br br br br br br br displaystyle hat N br br In this context each value of y is considered constant and the variability comes from the selection procedure This in contrast to model based approaches in which the randomness is often described in the y values The survey sampling procedure yields a series of Bernoulli indicator values br br br br br I br br i br br br br br displaystyle I i br br that get if some observation i is in the sample and if it was not selected This can occur with fixed sample size or varied sample size sampling e g Poisson sampling The probability of some element to be chosen given a sample is denoted as br br br br P br br br I br br i br br br br br br br Some sample of size br br n br br br br br br i br br br br br displaystyle P I i mid text Some sample of size n pi i br br and the one draw probability of selection is br br br br P br br br I br br i br br br br br br br br br one sample draw br br br br br p br br i br br br br br br br br br i br br br n br br br br br displaystyle P I i text one sample draw p i approx frac pi i n br br If N is very large and each br br br br br p br br i br br br br br displaystyle p i br br is very small For the following derivation we ll assume that the probability of selecting each element is fully represented by these probabilities I e selecting some element will not influence the probability of drawing another element this doesn t apply for things such as cluster sampling design br Since each element br br br br br y br br i br br br br br displaystyle y i br br is fixed and the randomness comes from it being included in the sample or not br br br br br I br br i br br br br br displaystyle I i br br we often talk about the multiplication of the two which is a random variable To avoid confusion in the following section let s call this term br br br br br y br br i br br br br br br y br br i br br br br I br br i br br br br br displaystyle y i y i I i br br With the following expectancy br br br br E br br br y br br i br br br br br br br y br br i br br br E br br br I br br i br br br br br br y br br i br br br br br br i br br br br br displaystyle E y i y i E I i y i pi i br br and variance br br br br V br br br y br br i br br br br br br br y br br i br br br br br br V br br br I br br i br br br br br br y br br i br br br br br br br br br i br br br br br br br br br i br br br br br br displaystyle V y i y i V I i y i pi i pi i br br br When each element of the sample is inflated by the inverse of its selection probability it is termed the br br br br br br br displaystyle pi br br expanded y values i e br br br br br br br br y br br br br br br i br br br br br br br y br br i br br br br br br i br br br br br br br displaystyle check y i frac y i pi i br br A related quantity is br br br br p br br br displaystyle p br br expanded y values br br br br br br br y br br i br br br br p br br i br br br br br br n br br br br br y br br br br br br i br br br br br displaystyle frac y i p i n check y i br br As above we can add a tick mark if multiplying by the indicator function I e br br br br br br br br y br br br br br br i br br br br br br I br br i br br br br br br br y br br br br br br i br br br br br br br br I br br i br br br br y br br i br br br br br br br i br br br br br br br displaystyle check y i I i check y i frac I i y i pi i br br br In this design based perspective the weights used in the numerator of the weighted mean are obtained from taking the inverse of the selection probability i e the inflation factor I e br br br br br w br br i br br br br br br br br br br i br br br br br br br br br br n br br br p br br i br br br br br br br br displaystyle w i frac pi i approx frac n times p i br br br br br Variance of the weighted sum pwr estimator for totals br If the population size N is known we can estimate the population mean using br br br br br br br br br br Y br br br br br br br br br br known br br N br br br br br br br br br br Y br br br br br br p br w br r br br br N br br br br br br br br br br i br br br br br n br br br br w br br i br br br br y br br i br br br br br N br br br br br displaystyle hat bar Y text known N frac hat Y pwr N approx frac sum i n w i y i N br br br If the sampling design is one that results in a fixed sample size n such as in pps sampling then the variance of this estimator is br br br br br Var br br br br br br br br br br Y br br br br br br br br br br known br br N br br br br br br br br br br N br br br br br br br br br n br br n br br br br br br br br br i br br br br br n br br br br br br br br w br br i br br br br y br br i br br br br br br br w br y br br br br br br br br br br br br br br displaystyle operatorname Var left hat bar Y text known N right frac N frac n n sum i n left w i y i overline wy right br br br An alternative term for when the sampling has a random sample size as in Poisson sampling is presented in Sarndal et al as br br With br br br br br br br br y br br br br br br i br br br br br br br y br br i br br br br br br i br br br br br br br displaystyle check y i frac y i pi i br br Also br br br br C br br br I br br i br br br br br I br br j br br br br br br br br i br j br br br br br br br i br br br br br br j br br br br br br br i br j br br br br br displaystyle C I i I j pi ij pi i pi j Delta ij br br where br br br br br br br i br j br br br br br displaystyle pi ij br br is the probability of selecting both i and j And br br br br br br br br br br br br br br i br j br br br br br br br br br br br br i br br br br br br j br br br br br br br i br j br br br br br br br displaystyle check Delta ij frac pi i pi j pi ij br br and for i j br br br br br br br br br br br br br br i br i br br br br br br br br br br br br i br br br br br br i br br br br br br br i br br br br br br br br br br br i br br br br br displaystyle check Delta ii frac pi i pi i pi i pi i br br br If the selection probability are uncorrelated i e br br br br br i br br j br br C br br br I br br i br br br br br I br br j br br br br br br br br displaystyle forall i neq j C I i I j br br and when assuming the probability of each element is very small then br br br br br Var br br br br br br br br br Y br br br br br br br br br br pwr known br br N br br br br br br br br br br br br N br br br br br br br br br br i br br br br br n br br br br br br br br w br br i br br br br y br br i br br br br br br br br br br br br displaystyle operatorname Var hat bar Y text pwr known N text frac N sum i n left w i y i right br br br br Variance of the weighted mean estimator for ratio mean br The previous section dealt with estimating the population mean as a ratio of an estimated population total br br br br br br br Y br br br br br br br displaystyle hat Y br br with a known population size br br br br N br br br displaystyle N br br and the variance was estimated in that context Another common case is that the population size itself br br br br N br br br displaystyle N br br is unknown and is estimated using the sample i e br br br br br br br N br br br br br br br displaystyle hat N br br The estimation of br br br br N br br br displaystyle N br br can be described as the sum of weights So when br br br br br w br br i br br br br br br br br br br i br br br br br br br displaystyle w i frac pi i br br we get br br br br br br br N br br br br br br br br br i br br br br br n br br br br w br br i br br br br I br br i br br br br br br br i br br br br br n br br br br br br I br br i br br br br br br i br br br br br br br br br i br br br br br n br br br br br br br br br br br br br i br br br br br br displaystyle hat N sum i n w i I i sum i n frac I i pi i sum i n check i br br With the above notation the parameter we care about is the ratio of the sums of br br br br br y br br i br br br br br displaystyle y i br br s and s I e br br br br R br br br br br Y br br br br br br br br br br br br i br br br br br N br br br br br br y br br i br br br br br br i br br br br br br br br br br i br br br br br N br br br br br br br br br i br br br br br br br br br br br br br br br i br br br br br N br br br br br br br y br br br br br br i br br br br br br br br i br br br br br N br br br br br br br br br br br br br i br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br y br br i br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br displaystyle R bar Y frac sum i N frac y i pi i sum i N frac pi i frac sum i N check y i sum i N check i frac sum i N w i y i sum i N w i br br We can estimate it using our sample with br br br br br br br R br br br br br br br br br br br Y br br br br br br br br br br br br br br br i br br br br br N br br br br I br br i br br br br br br y br br i br br br br br br i br br br br br br br br br br i br br br br br N br br br br I br br i br br br br br br br br br i br br br br br br br br br br br br br br br i br br br br br N br br br br br br br y br br br br br br i br br br br br br br br br i br br br br br N br br br br br br br br br br br br br i br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br y br br i br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br i br br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br y br br i br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br i br br br br br br br br br br br br y br br br br br br w br br br br br displaystyle hat R hat bar Y frac sum i N I i frac y i pi i sum i N I i frac pi i frac sum i N check y i sum i N check i frac sum i N w i y i sum i N w i i frac sum i n w i y i sum i n w i i bar y w br br As we moved from using N to using n we actually know that all the indicator variables get so we could simply write br br br br br br br br y br br br br br br w br br br br br br br br br br i br br br br br n br br br br w br br i br br br br y br br i br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br displaystyle bar y w frac sum i n w i y i sum i n w i br br This will be the estimand for specific values of y and w but the statistical properties comes when including the indicator variable br br br br br br br br y br br br br br br w br br br br br br br br br br i br br br br br n br br br br w br br i br br br br y br br i br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br i br br br br br br br br br displaystyle bar y w frac sum i n w i y i sum i n w i i br br br This is called a Ratio estimator and it is approximately unbiased for R br In this case the variability of the ratio depends on the variability of the random variables both in the numerator and the denominator as well as their correlation Since there is no closed analytical form to compute this variance various methods are used for approximate estimation Primarily Taylor series first order linearization asymptotics and bootstrap jackknife The Taylor linearization method could lead to under estimation of the variance for small sample sizes in general but that depends on the complexity of the statistic For the weighted mean the approximate variance is supposed to be relatively accurate even for medium sample sizes For when the sampling has a random sample size as in Poisson sampling it is as follows br br br br br br br br br V br br br br br br y br br br br br br w br br br br br br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br br br br br br br br i br br br br br n br br br br w br br i br br br br br br br br y br br i br br br br br br br br y br br br br br br w br br br br br br br br br br br displaystyle widehat V bar y w frac sum i n w i sum i n w i y i bar y w br br br If br br br br br br br i br br br br br p br br i br br br n br br br displaystyle pi i approx p i n br br then either using br br br br br w br br i br br br br br br br br br br i br br br br br br br displaystyle w i frac pi i br br or br br br br br w br br i br br br br br br br br p br br i br br br br br br br displaystyle w i frac p i br br would give the same estimator since multiplying br br br br br w br br i br br br br br displaystyle w i br br by some factor would lead to the same estimator It also means that if we scale the sum of weights to be equal to a known from before population size N the variance calculation would look the same When all weights are equal to one another this formula is reduced to the standard unbiased variance estimator br br We have at least two versions of variance for the weighted mean one with known and one with unknown population size estimation There is no uniformly better approach but the literature presents several arguments to prefer using the population estimation version even when the population size is known For example if all y values are constant the estimator with unknown population size will give the correct result while the one with known population size will have some variability Also when the sample size itself is random e g in Poisson sampling the version with unknown population mean is considered more stable Lastly if the proportion of sampling is negatively correlated with the values i e smaller chance to sample an observation that is large then the un known population size version slightly compensates for that br For the trivial case in which all the weights are equal to the above formula is just like the regular formula for the variance of the mean but notice that it uses the maximum likelihood estimator for the variance instead of the unbiased variance I e dividing it by n instead of n br br br Bootstrapping validation br It has been shown by Gatz et al that in comparison to bootstrapping methods the following variance estimation of ratio mean using Taylor series linearization is a reasonable estimation for the square of the standard error of the mean when used in the context of measuring chemical constituents br br br br br br br br br br br br br br br x br br br br br br w br br br br br br br br br br br br br br br n br br br n br br br br br n br br br br w br br br br br br br br br br br br br br br br br br br br w br br i br br br br x br br i br br br br br br br w br br br br br br br br br x br br br br br br w br br br br br br br br br br br br br br br x br br br br br br w br br br br br br w br br i br br br br br br br w br br br br br br br br w br br i br br br br x br br i br br br br br br br w br br br br br br br br br x br br br br br br w br br br br br br br br br x br br br br br br w br br br br br br br br br w br br i br br br br br br br w br br br br br br br br br br br br br br br br displaystyle widehat sigma bar x w frac n n n bar w left sum w i x i bar w bar x w bar x w sum w i bar w w i x i bar w bar x w bar x w sum w i bar w right br br br where br br br br br br br w br br br br br br br br br br br w br br i br br br br n br br br br br displaystyle bar w frac sum w i n br br Further simplification leads to br br br br br br br br br br br br br x br br br br br br br br br br br br br br br br n br br br n br br br br br n br br br br w br br br br br br br br br br br br br br br br w br br i br br br br br br br br x br br i br br br br br br br br x br br br br br br w br br br br br br br br br br br displaystyle widehat sigma bar x frac n n n bar w sum w i x i bar x w br br br Gatz et al mention that the above formulation was published by Endlich et al when treating the weighted mean as a combination of a weighted total estimator divided by an estimator of the population size based on the formulation published by Cochran as an approximation to the ratio mean However Endlich et al didn t seem to publish this derivation in their paper even though they mention they used it and Cochran s book includes a slightly different formulation Still it s almost identical to the formulations described in previous sections br br br Replication based estimators br Because there is no closed analytical form for the variance of the weighted mean it was proposed in the literature to rely on replication methods such as the Jackknife and Bootstrapping br br br Other notes br For uncorrelated observations with variances br br br br br br br i br br br br br br br br displaystyle sigma i br br the variance of the weighted sample mean is br br br br br br br br br br x br br br br br br br br br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br br br br i br br br br br br br br br displaystyle sigma bar x sum i n w i sigma i br br br whose square root br br br br br br br br br x br br br br br br br br displaystyle sigma bar x br br can be called the standard error of the weighted mean general case br Consequently if all the observations have equal variance br br br br br br br i br br br br br br br br br br br br br br br br br br displaystyle sigma i sigma br br the weighted sample mean will have variance br br br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br br br br br displaystyle sigma bar x sigma sum i n w i br br br where br br br br br br br br n br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br br br br br br textstyle n leq sum i n w i leq br br The variance attains its maximum value br br br br br br br br br br br br br br br displaystyle sigma br br when all weights except one are zero Its minimum value is found when all weights are equal i e unweighted mean in which case we have br br br br br br br br br x br br br br br br br br br br br br br br br br br br n br br br br br textstyle sigma bar x sigma sqrt n br br i e it degenerates into the standard error of the mean squared br Because one can always transform non normalized weights to normalized weights all formulas in this section can be adapted to non normalized weights by replacing all br br br br br w br br i br br br br br br br br w br br i br br br br br br br i br br br br br n br br br br br w br br i br br br br br br br br br displaystyle w i frac w i sum i n w i br br br br br Related concepts br br br Weighted sample variance br br Typically when a mean is calculated it is important to know the variance and standard deviation about that mean When a weighted mean br br br br br br br br br br br br displaystyle mu br br is used the variance of the weighted sample is different from the variance of the unweighted sample br The biased weighted sample variance br br br br br br br br br br br br br br br w br br br br br br br br br displaystyle hat sigma mathrm w br br is defined similarly to the normal biased sample variance br br br br br br br br br br br br br br br br br br br displaystyle hat sigma br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br br br br br x br br i br br br br br br br br br br br br br N br br br br br br br br br br br br br br br br br br w br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br x br br i br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br br br displaystyle begin aligned hat sigma frac sum limits i N left x i mu right N hat sigma mathrm w frac sum limits i N w i left x i mu right sum i N w i end aligned br br br where br br br br br br br i br br br br br N br br br br w br br i br br br br br br br displaystyle sum i N w i br br for normalized weights If the weights are frequency weights and thus are random variables it can be shown that br br br br br br br br br br br br br br br w br br br br br br br br br displaystyle hat sigma mathrm w br br is the maximum likelihood estimator of br br br br br br br br br br br br displaystyle sigma br br for iid Gaussian observations br For small samples it is customary to use an unbiased estimator for the population variance In normal unweighted samples the N in the denominator corresponding to the sample size is changed to N see Bessel s correction In the weighted setting there are actually two different unbiased estimators one for the case of frequency weights and another for the case of reliability weights br br br Frequency weights br If the weights are frequency weights where a weight equals the number of occurrences then the unbiased estimator is br br br br br br s br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br x br br i br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br displaystyle s frac sum limits i N w i left x i mu right sum i N w i br br br This effectively applies Bessel s correction for frequency weights br For example if values br br br br br br br br br br br br br br br br br br br displaystyle br br are drawn from the same distribution then we can treat this set as an unweighted sample or we can treat it as the weighted sample br br br br br br br br br br br br br displaystyle br br with corresponding weights br br br br br br br br br br br br br displaystyle br br and we get the same result either way br If the frequency weights br br br br br br w br br i br br br br br br displaystyle w i br br are normalized to then the correct expression after Bessel s correction becomes br br br br br br s br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br x br br i br br br br br br br br br br br br br br br br br br br displaystyle s frac sum i N w i sum i N w i sum i N w i left x i mu right br br br where the total number of samples is br br br br br br br i br br br br br N br br br br w br br i br br br br br displaystyle sum i N w i br br not br br br br N br br br displaystyle N br br In any case the information on total number of samples is necessary in order to obtain an unbiased correction even if br br br br br w br br i br br br br br displaystyle w i br br has a different meaning other than frequency weight br The estimator can be unbiased only if the weights are not standardized nor normalized these processes changing the data s mean and variance and thus leading to a loss of the base rate the population count which is a requirement for Bessel s correction br br br Reliability weights br If the weights are instead non random reliability weights we can determine a correction factor to yield an unbiased estimator Assuming each random variable is sampled from the same distribution with mean br br br br br br br displaystyle mu br br and actual variance br br br br br br br actual br br br br br br br br displaystyle sigma text actual br br taking expectations we have br br br br br br br br br E br br br br br br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br E br br br br br x br br i br br br br br br br br br br br br br N br br br br br br br br br br E br br br br X br br E br br br X br br br br br br br br br br br br br N br br br E br br br br X br br E br br br X br br br br br br br br br br br br br br br br br br br br br N br br br br N br br br br br br br br actual br br br br br br br br br br E br br br br br br br br br br br br br br w br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br E br br br br br x br br i br br br br br br br br br br br br br br br br br br br V br br br br br br br br br br br br br br E br br br br X br br E br br br X br br br br br br br br br br br br br V br br br br br br V br br br br br br br br br br E br br br br X br br E br br br X br br br br br br br br br br br br br br br br br br br br br br br br V br br br br br br V br br br br br br br br br br br br br br br br actual br br br br br br br br br br br br displaystyle begin aligned operatorname E hat sigma frac sum limits i N operatorname E x i mu N operatorname E X operatorname E X frac N operatorname E X operatorname E X left frac N N right sigma text actual operatorname E hat sigma mathrm w frac sum limits i N w i operatorname E x i mu V operatorname E X operatorname E X frac V V operatorname E X operatorname E X left frac V V right sigma text actual end aligned br br br where br br br br br V br br br br br br br br br i br br br br br N br br br br w br br i br br br br br displaystyle V sum i N w i br br and br br br br br V br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br displaystyle V sum i N w i br br Therefore the bias in our estimator is br br br br br br br br br br br br V br br br br br br V br br br br br br br br br br br br br br br displaystyle left frac V V right br br analogous to the br br br br br br br br br N br br br br N br br br br br br br displaystyle left frac N N right br br bias in the unweighted estimator also notice that br br br br br br V br br br br br br br br br br br br V br br br br br br br N br br e br f br f br br br br br displaystyle V V N eff br br is the effective sample size This means that to unbias our estimator we need to pre divide by br br br br br br br br br br V br br br br br br br br br V br br br br br br br br br br br br br displaystyle left V V right br br ensuring that the expected value of the estimated variance equals the actual variance of the sampling distribution br The final unbiased estimate of sample variance is br br br br br br br br br br s br br br w br br br br br br br br br br br br br br br br br br br br br br br br br w br br br br br br br br br br br br V br br br br br br br br br V br br br br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br x br br i br br br br br br br br br br br br br br br br br br br V br br br br br br br br V br br br br br br br br br V br br br br br br br br br br br br br br br br displaystyle begin aligned s mathrm w frac hat sigma mathrm w V V pt frac sum limits i N w i x i mu V V V end aligned br br br where br br br br E br br br br s br br br w br br br br br br br br br br br br actual br br br br br br br br displaystyle operatorname E s mathrm w sigma text actual br br br The degrees of freedom of the weighted unbiased sample variance vary accordingly from N down to br The standard deviation is simply the square root of the variance above br As a side note other approaches have been described to compute the weighted sample variance br br br Weighted sample covariance br In a weighted sample each row vector br br br br br br x br br br i br br br br br displaystyle mathbf x i br br each set of single observations on each of the K random variables is assigned a weight br br br br br w br br i br br br br br br br displaystyle w i geq br br br Then the weighted mean vector br br br br br br br br br br br br br br displaystyle mathbf mu br br is given by br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br x br br br i br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br displaystyle mathbf mu frac sum i N w i mathbf x i sum i N w i br br br And the weighted covariance matrix is given by br br br br br br C br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br x br br br i br br br br br br br br br br br br br br T br br br br br br br br x br br br i br br br br br br br br br br br br br br br V br br br br br br br br br br displaystyle mathbf C frac sum i N w i left mathbf x i mu right T left mathbf x i mu right V br br br Similarly to weighted sample variance there are two different unbiased estimators depending on the type of the weights br br br Frequency weights br If the weights are frequency weights the unbiased weighted estimate of the covariance matrix br br br br br br C br br br br br displaystyle textstyle mathbf C br br with Bessel s correction is given by br br br br br br C br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br x br br br i br br br br br br br br br br br br br br T br br br br br br br br x br br br i br br br br br br br br br br br br br br br br V br br br br br br br br br br br br br displaystyle mathbf C frac sum i N w i left mathbf x i mu right T left mathbf x i mu right V br br br This estimator can be unbiased only if the weights are not standardized nor normalized these processes changing the data s mean and variance and thus leading to a loss of the base rate the population count which is a requirement for Bessel s correction br br br Reliability weights br In the case of reliability weights the weights are normalized br br br br br br V br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br displaystyle V sum i N w i br br br If they are not divide the weights by their sum to normalize prior to calculating br br br br br V br br br br br br br displaystyle V br br br br br br br br w br br i br br br br br br br br w br br i br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br displaystyle w i frac w i sum i N w i br br br Then the weighted mean vector br br br br br br br br br br br br br br displaystyle mathbf mu br br can be simplified to br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br x br br br i br br br br br br displaystyle mathbf mu sum i N w i mathbf x i br br br and the unbiased weighted estimate of the covariance matrix br br br br br C br br br br displaystyle mathbf C br br is br br br br br br br br br br C br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br x br br br i br br br br br br br br br br br br br br T br br br br br br br br x br br br i br br br br br br br br br br br br br br br br br br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br x br br br i br br br br br br br br br br br br br br T br br br br br br br br x br br br i br br br br br br br br br br br br br br br br V br br br br br br br br V br br br br br br br br br V br br br br br br br br br br br br br br br br displaystyle begin aligned mathbf C frac sum i N w i left sum i N w i right sum i N w i sum i N w i left mathbf x i mu right T left mathbf x i mu right frac sum i N w i left mathbf x i mu right T left mathbf x i mu right V V V end aligned br br br The reasoning here is the same as in the previous section br Since we are assuming the weights are normalized then br br br br br V br br br br br br br br br displaystyle V br br and this reduces to br br br br br br C br br br br br br br br br i br br br br br N br br br br w br br i br br br br br br br br br x br br br i br br br br br br br br br br br br br br T br br br br br br br br x br br br i br br br br br br br br br br br br br br br br br br V br br br br br br br br br br br displaystyle mathbf C frac sum i N w i left mathbf x i mu right T left mathbf x i mu right V br br br If all weights are the same i e br br br br br w br br i br br br br br br br V br br br br br br br br br br N br br br displaystyle w i V N br br then the weighted mean and covariance reduce to the unweighted sample mean and covariance above br br br Vector valued estimates br The above generalizes easily to the case of taking the mean of vector valued estimates For example estimates of position on a plane may have less certainty in one direction than another As in the scalar case the weighted mean of multiple estimates can provide a maximum likelihood estimate We simply replace the variance br br br br br br br br br br br br displaystyle sigma br br by the covariance matrix br br br br br C br br br br displaystyle mathbf C br br and the arithmetic inverse by the matrix inverse both denoted in the same way via superscripts the weight matrix then reads br br The weighted mean in this case is br br where the order of the matrix vector product is not commutative in terms of the covariance of the weighted mean br br For example consider the weighted mean of the point with high variance in the second component and with high variance in the first component Then br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br C br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br displaystyle mathbf x begin bmatrix end bmatrix top qquad mathbf C begin bmatrix end bmatrix br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br C br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br displaystyle mathbf x begin bmatrix end bmatrix top qquad mathbf C begin bmatrix end bmatrix br br br then the weighted mean is br br br br br br br br br br br br br x br br br br br br br br br br br br br br br br C br br br br br br br br br br br br br C br br br br br br br br br br br br br br br br br br br br br br br C br br br br br br br br br br br br x br br br br br br br br br C br br br br br br br br br br br br x br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br br displaystyle begin aligned bar mathbf x left mathbf C mathbf C right left mathbf C mathbf x mathbf C mathbf x right pt begin bmatrix end bmatrix begin bmatrix end bmatrix begin bmatrix end bmatrix end aligned br br br which makes sense the estimate is compliant in the second component and the estimate is compliant in the first component so the weighted mean is nearly br br br Accounting for correlations br br In the general case suppose that br br br br br X br br br br br x br br br br br br br br br x br br n br br br br br br T br br br br br displaystyle mathbf X x dots x n T br br br br br br br C br br br br displaystyle mathbf C br br is the covariance matrix relating the quantities br br br br br x br br i br br br br br displaystyle x i br br br br br br br br br x br br br br br br br displaystyle bar x br br is the common mean to be estimated and br br br br br J br br br br displaystyle mathbf J br br is a design matrix equal to a vector of ones br br br br br br br br br br br br br T br br br br br displaystyle dots T br br of length br br br br n br br br displaystyle n br br The Gauss Markov theorem states that the estimate of the mean having minimum variance is given by br br br br br br br br br br x br br br br br br br br br br br br br J br br br T br br br br W br br br J br br br br br br br br br br br br displaystyle sigma bar x mathbf J T mathbf W mathbf J br br br and br br br br br br br br x br br br br br br br br br br br x br br br br br br br br br br br br J br br br T br br br br W br br br X br br br br br br displaystyle bar x sigma bar x mathbf J T mathbf W mathbf X br br br where br br br br br br W br br br br br C br br br br br br br br br br displaystyle mathbf W mathbf C br br br br Decreasing strength of interactions br Consider the time series of an independent variable br br br br x br br br displaystyle x br br and a dependent variable br br br br y br br br displaystyle y br br with br br br br n br br br displaystyle n br br observations sampled at discrete times br br br br br t br br i br br br br br displaystyle t i br br In many common situations the value of br br br br y br br br displaystyle y br br at time br br br br br t br br i br br br br br displaystyle t i br br depends not only on br br br br br x br br i br br br br br displaystyle x i br br but also on its past values Commonly the strength of this dependence decreases as the separation of observations in time increases To model this situation one may replace the independent variable by its sliding mean br br br br z br br br displaystyle z br br for a window size br br br br m br br br displaystyle m br br br br br br br br z br br k br br br br br br br i br br br br br m br br br br w br br i br br br br x br br k br br br br i br br br br br br displaystyle z k sum i m w i x k i br br br br Exponentially decreasing weights br br In the scenario described in the previous section most frequently the decrease in interaction strength obeys a negative exponential law If the observations are sampled at equidistant times then exponential decrease is equivalent to decrease by a constant fraction br br br br br br br br br br br displaystyle Delta br br at each time step Setting br br br br w br br br br br br br displaystyle w Delta br br we can define br br br br m br br br displaystyle m br br normalized weights by br br br br br br w br br i br br br br br br br w br br i br br br br br br V br br br br br br br br br br displaystyle w i frac w i V br br br where br br br br br V br br br br br br br displaystyle V br br is the sum of the unnormalized weights In this case br br br br br V br br br br br br br displaystyle V br br is simply br br br br br br V br br br br br br br br br i br br br br br m br br br br br w br br i br br br br br br br br br br br br br w br br m br br br br br br br w br br br br br br br displaystyle V sum i m w i frac w m w br br br approaching br br br br br V br br br br br br br br br br br br br w br br br br displaystyle V w br br for large values of br br br br m br br br displaystyle m br br br The damping constant br br br br w br br br displaystyle w br br must correspond to the actual decrease of interaction strength If this cannot be determined from theoretical considerations then the following properties of exponentially decreasing weights are useful in making a suitable choice at step br br br br br br br w br br br br br br br br br br displaystyle w br br the weight approximately equals br br br br br br e br br br br br br br br br br w br br br br br br br w br br br br displaystyle e w w br br the tail area the value br br br br br e br br br br br br br br displaystyle e br br the head area br br br br br br br br e br br br br br br br br br br br displaystyle e br br The tail area at step br br br br n br br br displaystyle n br br is br br br br br br br e br br br n br br br br w br br br br br br br displaystyle leq e n w br br Where primarily the closest br br br br n br br br displaystyle n br br observations matter and the effect of the remaining observations can be ignored safely then choose br br br br w br br br displaystyle w br br such that the tail area is sufficiently small br br br Weighted averages of functions br The concept of weighted average can be extended to functions Weighted averages of functions play an important role in the systems of weighted differential and integral calculus br br br Correcting for over or under dispersion br br Weighted means are typically used to find the weighted mean of historical data rather than theoretically generated data In this case there will be some error in the variance of each data point Typically experimental errors may be underestimated due to the experimenter not taking into account all sources of error in calculating the variance of each data point In this event the variance in the weighted mean must be corrected to account for the fact that br br br br br br br br br br br br displaystyle chi br br is too large The correction that must be made is br br br br br br br br br br br br br br br br br x br br br br br br br br br br br br br br br x br br br br br br br br br br br br br br br br br br br br displaystyle hat sigma bar x sigma bar x chi nu br br br where br br br br br br br br br br br br br br br displaystyle chi nu br br is the reduced chi squared br br br br br br br br br br br br br br br br br br br br n br br br br br br br br br br i br br br br br n br br br br br br br br x br br i br br br br br br br x br br br br br br br br br br br br br br br i br br br br br br br br br br br displaystyle chi nu frac n sum i n frac x i bar x sigma i br br br The square root br br br br br br br br br br br br br br br br x br br br br br br br br displaystyle hat sigma bar x br br can be called the standard error of the weighted mean variance weights scale corrected br When all data variances are equal br br br br br br br i br br br br br br br br br br br br displaystyle sigma i sigma br br they cancel out in the weighted mean variance br br br br br br br br br x br br br br br br br br br br br displaystyle sigma bar x br br which again reduces to the standard error of the mean squared br br br br br br br br br x br br br br br br br br br br br br br br br br br br br n br br br displaystyle sigma bar x sigma n br br formulated in terms of the sample standard deviation squared br br br br br br br br br br br br br br br br br br i br br br br br n br br br br br x br br i br br br br br br br x br br br br br br br br br br br br br n br br br br br br br br br displaystyle sigma frac sum i n x i bar x n br br br br See also br br br Notes br br br br br br Further reading br Bevington Philip R Data Reduction and Error Analysis for the Physical Sciences New York N Y McGraw Hill OCLC br Strutz T Data Fitting and Uncertainty A practical introduction to weighted least squares and beyond Vieweg Teubner ISBN br br br External links br David Terr Weighted Mean MathWorld br Tool to calculate Weighted Average