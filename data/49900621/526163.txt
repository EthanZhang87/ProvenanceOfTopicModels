title: Quark (kernel)
id: 526163
In computing Quark is an operating system kernel used in MorphOS It is a microkernel designed to run fully virtualized computers called boxes see sandbox As of only one box is available the ABox that lets users run extant AmigaOS software compiled for Motorola series MC x or k and PowerPC central processing units CPUs br br br Design goals br The Quark microkernel is not a member of the L microkernel family but borrows concepts from it including the clan group of tasks ID concept and recursive address mapping Quark also has an asynchronous synchronous message interface similar to Amiga s Exec kernel but adapted to an environment with memory protection br Other Quark features include br br High super usermode switch speed br Low interrupt latency br Interrupt threads IntThreads and Int P code abstraction br Symmetric multiprocessing SMP br Models task thread and clan chief br Resource tracking br Virtual memory optional br Distributed computing br No access to kernel structures br Clean design with an elegant application programming interface API br Micro pico kernel mix br For this new kernel a hardware abstraction layer is used which provides the needed hardware resource information like scanning all Amiga Zorro II bus boards Peripheral Component Interconnect PCI boards and local hardware resources br br br Functions br br br Trance JIT br Trance JIT is a MorphOS just in time JIT compiler or code translator for running k applications within the MorphOS environment It has been part of the MorphOS operating system since MorphOS br MorphOS has a fully integrated k emulator to run many Amiga applications which were almost exclusively compiled for the k processor though MorphOS runs on PowerPC Trance supplements this function by adding JIT compiling increasing the speed of the emulation It does not interfere with the full integration of k and PowerPC tasks MorphOS provides br Trance exists in the form of an executable run during boot and a shared library Although it is not technically part of the kernel and MorphOS can be run without it Trance is considered a fundamental part of MorphOS and one of its most powerful features br Compatibility of Trance is considered to be very high and there are few to no k instruction sequences or applications which cause it any problems It is also considered to be very fast with users noticing few differences between k programs and native PowerPC code br Trance was developed by Ralph Schmidt and Teemu Suikki with minor support from other MorphOS team members Mark Olsen Sigbj rn Skj ret and Harry Sintonen br br br ABox br Under the Quark kernel a PowerPC native reimplementation of the OS known from the Commodore International A A A A A A T and A T systems runs as a mix of a virtual emulation and a driver This OS driver is called an ABox br The k emulation is written in C and uses GNU Compiler Collection GCC assembly language macros where needed to speed up some complex instructions br A JIT engine named Trance is also available for MorphOS to speed up old k programs beyond the current state of the traditional emulation br The PPC native Exec supports the PowerPC register model which means there is no difference for this Exec if it runs k or PowerPC code PowerPC code does not block multitasking inside the OS box like in emulations where the k code is just emulated in some host system s task then every access outside this environment would stop the multitasking in the emulated environment br For applications running under this new PowerPC ABox kernel k code runs as subroutines inside PowerPC tasks For k or PowerPC applications it s fully transparent if some library hook interrupt is still k or already using PowerPC code br br br 