title: Log4Shell
id: 69481773
Log Shell CVE is a zero day vulnerability in Log j a popular Java logging framework involving arbitrary code execution The vulnerability had existed unnoticed since and was privately disclosed to the Apache Software Foundation of which Log j is a project by Chen Zhaojun of Alibaba Cloud s security team on November Before an official CVE identifier was made available on December the vulnerability circulated with the name Log Shell given by Free Wortley of the LunaSec team which was initially used to track the issue online Apache gave Log Shell a CVSS severity rating of the highest available score The exploit was simple to execute and is estimated to have had the potential to affect hundreds of millions of devices br The vulnerability takes advantage of Log j s allowing requests to arbitrary LDAP and JNDI servers allowing attackers to execute arbitrary Java code on a server or other computer or leak sensitive information A list of its affected software projects has been published by the Apache Security Team Affected commercial services include Amazon Web Services Cloudflare iCloud Minecraft Java Edition Steam Tencent QQ and many others According to Wiz and EY the vulnerability affected of enterprise cloud environments br The vulnerability s disclosure received strong reactions from cybersecurity experts Cybersecurity company Tenable said the exploit was the single biggest most critical vulnerability ever Ars Technica called it arguably the most severe vulnerability ever and The Washington Post said that descriptions by security professionals border on the apocalyptic br br br Background br br Log j is an open source logging framework that allows software developers to log data within their applications This data can include user input It is used ubiquitously in Java applications especially enterprise software Originally written in by Ceki G lc it is now part of Apache Logging Services a project of the Apache Software Foundation Tom Kellermann a member of President Obama s Commission on Cyber Security described Apache as one of the giant supports of a bridge that facilitates the connective tissue between the worlds of applications and computer environments br br br Behavior br The Java Naming and Directory Interface JNDI allows for lookup of Java objects at program runtime given a path to their data JNDI can use several directory interfaces each providing a different scheme of looking up files Among these interfaces is the Lightweight Directory Access Protocol LDAP a non Java specific protocol which retrieves the object data as a URL from an appropriate server either local or anywhere on the Internet br In the default configuration when logging a string Log j performs string substitution on expressions of the form prefix name For example Text java version might be converted to Text Java version Among the recognized expressions is jndi lookup by specifying the lookup to be through LDAP an arbitrary URL may be queried and loaded as Java object data jndi ldap example com file for example will load data from that URL if connected to the Internet By inputting a string that is logged an attacker can load and execute malicious code hosted on a public URL Even if execution of the data is disabled an attacker can still retrieve data such as secret environment variables by placing them in the URL in which case they will be substituted and sent to the attacker s server Besides LDAP other potentially exploitable JNDI lookup protocols include its secure variant LDAPS Java Remote Method Invocation RMI the Domain Name System DNS and the Internet Inter ORB Protocol IIOP br Because HTTP requests are frequently logged a common attack vector is placing the malicious string in the HTTP request URL or a commonly logged HTTP header such as User Agent Early mitigations included blocking any requests containing potentially malicious contents such as jndi Such basic string matching solutions can be circumvented by obfuscating the request lower j ndi for example will be converted into a JNDI lookup after performing the lowercase operation on the letter j Even if an input such as a first name is not immediately logged it may be later logged during internal processing and its contents executed br br br Mitigation br Fixes for this vulnerability were released on December three days before the vulnerability was published in Log j version rc The fix included restricting the servers and protocols that may be used for lookups Researchers discovered a related bug CVE that allows local or remote code execution in certain non default configurations and was fixed in version which disabled all features using JNDI and support for message lookups Two more vulnerabilities in the library were found a denial of service attack tracked as CVE and fixed in and a difficult to exploit remote code execution vulnerability tracked as CVE and fixed in For previous versions the class org apache logging log j core lookup JndiLookup needs to be removed from the classpath to mitigate both vulnerabilities An early recommended fix for older versions was to set the system property log j formatMsgNoLookups to true but this change does not prevent exploitation of CVE and was later found to not disable message lookups in certain cases br Newer versions of the Java Runtime Environment JRE also mitigate this vulnerability by blocking remote code from being loaded by default although other attack vectors still exist in certain applications Several methods and tools have been published that help detect vulnerable Log j versions used in built Java packages br Where applying updated versions has not been possible due to a variety of constraints such as lack of resources or third party managed solutions filtering outbound network traffic from vulnerable deployments has been the primary recourse for many The approach is recommended by NCC Group and the National Cyber Security Centre United Kingdom and is an example of a defense in depth measure The effectiveness of such filtering is evidenced by laboratory experiments conducted with firewalls capable of intercepting the egress traffic with several wholly or partially vulnerable versions of the library itself and the JRE br br br Usage br The exploit allows hackers to gain control of vulnerable devices using Java Some hackers employ the vulnerability to use victims devices for cryptocurrency mining creating botnets sending spam establishing backdoors and other illegal activities such as ransomware attacks In the days following the vulnerability s disclosure Check Point observed millions of attacks being initiated by hackers with some researchers observing a rate of over one hundred attacks per minute that ultimately resulted with attempted attacks on over of business networks internationally br According to Cloudflare CEO Matthew Prince evidence of exploitation of or scanning for the exploit goes back as early as December nine days before it was publicly disclosed According to cybersecurity firm GreyNoise several IP addresses were scraping websites to check for servers that had the vulnerability Several botnets began scanning for the vulnerability including the Muhstik botnet by December as well as Mirai and Tsunami Ransomware group Conti was observed using the vulnerability on December br Some state sponsored groups in China and Iran also utilized the exploit according to Check Point but it is not known if the exploit was used by Israel Russia or the United States prior to the disclosure of the vulnerability Check Point said that on December Iran backed hackers attempted to infiltrate the networks of Israeli businesses and government institutions br br br Response and impact br br br Governmental br In the United States the director of the Cybersecurity and Infrastructure Security Agency CISA Jen Easterly described the exploit as one of the most serious I ve seen in my entire career if not the most serious explaining that hundreds of millions of devices were affected and advising vendors to prioritize software updates Civilian agencies contracted by the United States government had until December to patch vulnerabilities On January the Federal Trade Commission FTC stated its intent to pursue companies that fail to take reasonable steps to update used Log j software In a White House meeting the importance of security maintenance of open source software often also carried out largely by few volunteers to national security was clarified While some open source projects have many eyes on them others do not have many or any people ensuring their security br Germany s Bundesamt f r Sicherheit in der Informationstechnik BSI designated the exploit as being at the agency s highest threat level calling it an extremely critical threat situation translated It also reported that several attacks were already successful and that the extent of the exploit remained hard to assess The Netherlands s National Cyber Security Centre NCSC began an ongoing list of vulnerable applications br The Canadian Centre for Cyber Security CCCS called on organizations to take immediate action The Canada Revenue Agency temporarily shut down its online services after learning of the exploit while the Government of Quebec closed almost of its websites as a preventative measure The Belgian Ministry of Defence experienced a breach attempt and was forced to shut down part of its network br The Chinese Ministry of Industry and Information Technology suspended work with Alibaba Cloud as a cybersecurity threat intelligence partner for six months for failing to report the vulnerability to the government first br br br Businesses br Research conducted by Wiz and EY showed that of the cloud enterprise environment were vulnerable to Log Shell of vulnerable workloads are exposed to the Internet and prone to wide exploitation attempts According to the research ten days after vulnerability disclosure December only of vulnerable workloads were patched on average in cloud environments Amazon Google and Microsoft cloud data was affected by Log Shell Microsoft asked Windows and Azure customers to remain vigilant after observing state sponsored and cyber criminal attackers probing systems for the Log j Log Shell flaw through December br The human resource management and workforce management company UKG one of the largest businesses in the industry was targeted by a ransomware attack that affected large businesses UKG said it did not have evidence of Log Shell being exploited in the incident though analyst Allan Liska from cybersecurity company Recorded Future said there was possibly a connection br As larger companies began to release patches for the exploit the risk for small businesses increased as hackers focused on more vulnerable targets br br br Privacy br Some personal devices connected to the Internet such as smart TVs and security cameras were vulnerable to the exploit Some software may never get a patch due to discontinued manufacturer support br br br Analysis br As of December almost half of all corporate networks globally have been actively probed with over variants of the exploit having been produced within hours Check Point Software Technologies in a detailed analysis described the situation as being a true cyber pandemic and characterizing the potential for damage as being incalculable Several initial advisories exaggerated the amount of packages that were vulnerable leading to false positives Most notably the log j api package was marked as vulnerable while in reality further research showed that only the main log j core package was vulnerable This was confirmed both in the original issue thread and by external security researchers br Technology magazine Wired wrote that despite the previous hype surrounding multiple vulnerabilities the Log j vulnerability lives up to the hype for a host of reasons The magazine explains that the pervasiveness of Log j the vulnerability being difficult to detect by potential targets and the ease of transmitting code to victims created a combination of severity simplicity and pervasiveness that has the security community rattled Wired also outlined stages of hackers using Log Shell cryptomining groups first using the vulnerability data brokers then selling a foothold to cybercriminals who finally go on to engage in ransomware attacks espionage and destroying data br Amit Yoran CEO of Tenable and the founding director of the United States Computer Emergency Readiness Team stated Log Shell is by far the single biggest most critical vulnerability ever noting that sophisticated attacks were beginning shortly after the bug saying We re also already seeing it leveraged for ransomware attacks which again should be a major alarm bell We ve also seen reports of attackers using Log Shell to destroy systems without even looking to collect ransom a fairly unusual behavior Sophos s senior threat researcher Sean Gallagher said Honestly the biggest threat here is that people have already gotten access and are just sitting on it and even if you remediate the problem somebody s already in the network It s going to be around as long as the Internet br According to a Bloomberg News report some anger was directed at Apache s developers at their failure to fix the vulnerability after warnings about exploits of broad classes of software including Log j were made at a cybersecurity conference br br br br br br External links br Log j website br NCSC overview of Log Shell on GitHub br Common Vulnerabilities and Exposures page br National Vulnerabilities Database page br Projects affected by cve by Apache Security Team